<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>目录 | 云上舟</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="个人学习博客">
    
    <link rel="preload" href="/js-book/assets/css/0.styles.8a3be0d4.css" as="style"><link rel="preload" href="/js-book/assets/js/app.f61b122d.js" as="script"><link rel="preload" href="/js-book/assets/js/2.2de41c35.js" as="script"><link rel="preload" href="/js-book/assets/js/3.693556bf.js" as="script"><link rel="preload" href="/js-book/assets/js/31.8158df5d.js" as="script"><link rel="prefetch" href="/js-book/assets/js/10.2e929d5c.js"><link rel="prefetch" href="/js-book/assets/js/100.599ab4eb.js"><link rel="prefetch" href="/js-book/assets/js/101.624e6e5d.js"><link rel="prefetch" href="/js-book/assets/js/102.0f56ae3d.js"><link rel="prefetch" href="/js-book/assets/js/103.7b431756.js"><link rel="prefetch" href="/js-book/assets/js/104.f8ebd95f.js"><link rel="prefetch" href="/js-book/assets/js/105.79d2a0f1.js"><link rel="prefetch" href="/js-book/assets/js/106.2c07c8e6.js"><link rel="prefetch" href="/js-book/assets/js/107.de5dc7d7.js"><link rel="prefetch" href="/js-book/assets/js/108.e2ddf741.js"><link rel="prefetch" href="/js-book/assets/js/109.3b9ae586.js"><link rel="prefetch" href="/js-book/assets/js/11.63d27d24.js"><link rel="prefetch" href="/js-book/assets/js/110.bc9af71e.js"><link rel="prefetch" href="/js-book/assets/js/111.11b42a30.js"><link rel="prefetch" href="/js-book/assets/js/112.8cd34611.js"><link rel="prefetch" href="/js-book/assets/js/113.0c5af703.js"><link rel="prefetch" href="/js-book/assets/js/12.73e770b0.js"><link rel="prefetch" href="/js-book/assets/js/13.65637008.js"><link rel="prefetch" href="/js-book/assets/js/14.cb506622.js"><link rel="prefetch" href="/js-book/assets/js/15.44ab434e.js"><link rel="prefetch" href="/js-book/assets/js/16.3fdd61b9.js"><link rel="prefetch" href="/js-book/assets/js/17.90cca224.js"><link rel="prefetch" href="/js-book/assets/js/18.7005bc07.js"><link rel="prefetch" href="/js-book/assets/js/19.9820bbef.js"><link rel="prefetch" href="/js-book/assets/js/20.fe043307.js"><link rel="prefetch" href="/js-book/assets/js/21.9f9c401e.js"><link rel="prefetch" href="/js-book/assets/js/22.7a337db5.js"><link rel="prefetch" href="/js-book/assets/js/23.7b17a651.js"><link rel="prefetch" href="/js-book/assets/js/24.06fb07c6.js"><link rel="prefetch" href="/js-book/assets/js/25.7dedce4d.js"><link rel="prefetch" href="/js-book/assets/js/26.2f8625e9.js"><link rel="prefetch" href="/js-book/assets/js/27.5db7d134.js"><link rel="prefetch" href="/js-book/assets/js/28.3b8d7011.js"><link rel="prefetch" href="/js-book/assets/js/29.c1897dfb.js"><link rel="prefetch" href="/js-book/assets/js/30.97b487e8.js"><link rel="prefetch" href="/js-book/assets/js/32.ed0d71d8.js"><link rel="prefetch" href="/js-book/assets/js/33.519067fc.js"><link rel="prefetch" href="/js-book/assets/js/34.05907c2b.js"><link rel="prefetch" href="/js-book/assets/js/35.a15df5ee.js"><link rel="prefetch" href="/js-book/assets/js/36.fdce16c2.js"><link rel="prefetch" href="/js-book/assets/js/37.8d00a8d9.js"><link rel="prefetch" href="/js-book/assets/js/38.b1d12b76.js"><link rel="prefetch" href="/js-book/assets/js/39.f3328998.js"><link rel="prefetch" href="/js-book/assets/js/4.9676d5a3.js"><link rel="prefetch" href="/js-book/assets/js/40.d9678df0.js"><link rel="prefetch" href="/js-book/assets/js/41.a8470368.js"><link rel="prefetch" href="/js-book/assets/js/42.e27efb7b.js"><link rel="prefetch" href="/js-book/assets/js/43.ffe0e34e.js"><link rel="prefetch" href="/js-book/assets/js/44.80738e92.js"><link rel="prefetch" href="/js-book/assets/js/45.9e91c4f4.js"><link rel="prefetch" href="/js-book/assets/js/46.dbcc8520.js"><link rel="prefetch" href="/js-book/assets/js/47.7157c5bb.js"><link rel="prefetch" href="/js-book/assets/js/48.6c4e1081.js"><link rel="prefetch" href="/js-book/assets/js/49.9b09fddf.js"><link rel="prefetch" href="/js-book/assets/js/5.927391fc.js"><link rel="prefetch" href="/js-book/assets/js/50.1ad577e1.js"><link rel="prefetch" href="/js-book/assets/js/51.b93749b0.js"><link rel="prefetch" href="/js-book/assets/js/52.5a0c24a2.js"><link rel="prefetch" href="/js-book/assets/js/53.178b9a40.js"><link rel="prefetch" href="/js-book/assets/js/54.c5ae96f5.js"><link rel="prefetch" href="/js-book/assets/js/55.237318f7.js"><link rel="prefetch" href="/js-book/assets/js/56.1592395e.js"><link rel="prefetch" href="/js-book/assets/js/57.87a1ca7a.js"><link rel="prefetch" href="/js-book/assets/js/58.6e8033dc.js"><link rel="prefetch" href="/js-book/assets/js/59.98c84e21.js"><link rel="prefetch" href="/js-book/assets/js/6.17dc4b34.js"><link rel="prefetch" href="/js-book/assets/js/60.4b132455.js"><link rel="prefetch" href="/js-book/assets/js/61.39d4c778.js"><link rel="prefetch" href="/js-book/assets/js/62.4a007e57.js"><link rel="prefetch" href="/js-book/assets/js/63.24f0c87b.js"><link rel="prefetch" href="/js-book/assets/js/64.8c684a13.js"><link rel="prefetch" href="/js-book/assets/js/65.b9d86ac1.js"><link rel="prefetch" href="/js-book/assets/js/66.e954c398.js"><link rel="prefetch" href="/js-book/assets/js/67.83a582d2.js"><link rel="prefetch" href="/js-book/assets/js/68.b940db63.js"><link rel="prefetch" href="/js-book/assets/js/69.f923d6a4.js"><link rel="prefetch" href="/js-book/assets/js/7.fd8d6830.js"><link rel="prefetch" href="/js-book/assets/js/70.e81a8bf1.js"><link rel="prefetch" href="/js-book/assets/js/71.76a541e0.js"><link rel="prefetch" href="/js-book/assets/js/72.c9d23f79.js"><link rel="prefetch" href="/js-book/assets/js/73.d7b22b48.js"><link rel="prefetch" href="/js-book/assets/js/74.08dc0e9b.js"><link rel="prefetch" href="/js-book/assets/js/75.964d6fa1.js"><link rel="prefetch" href="/js-book/assets/js/76.3c034d35.js"><link rel="prefetch" href="/js-book/assets/js/77.ba88385c.js"><link rel="prefetch" href="/js-book/assets/js/78.abff29df.js"><link rel="prefetch" href="/js-book/assets/js/79.c482a28f.js"><link rel="prefetch" href="/js-book/assets/js/8.292159d2.js"><link rel="prefetch" href="/js-book/assets/js/80.73b9ed7b.js"><link rel="prefetch" href="/js-book/assets/js/81.e5d12904.js"><link rel="prefetch" href="/js-book/assets/js/82.7343cec4.js"><link rel="prefetch" href="/js-book/assets/js/83.72b6a14e.js"><link rel="prefetch" href="/js-book/assets/js/84.4d2dd943.js"><link rel="prefetch" href="/js-book/assets/js/85.c8706d09.js"><link rel="prefetch" href="/js-book/assets/js/86.ba743348.js"><link rel="prefetch" href="/js-book/assets/js/87.521e67ce.js"><link rel="prefetch" href="/js-book/assets/js/88.24596a1f.js"><link rel="prefetch" href="/js-book/assets/js/89.a7cb6521.js"><link rel="prefetch" href="/js-book/assets/js/9.14dc661d.js"><link rel="prefetch" href="/js-book/assets/js/90.ed6d3b49.js"><link rel="prefetch" href="/js-book/assets/js/91.d9d9cf02.js"><link rel="prefetch" href="/js-book/assets/js/92.f9fa8314.js"><link rel="prefetch" href="/js-book/assets/js/93.4c916426.js"><link rel="prefetch" href="/js-book/assets/js/94.f480ae68.js"><link rel="prefetch" href="/js-book/assets/js/95.735537a4.js"><link rel="prefetch" href="/js-book/assets/js/96.f5ef6517.js"><link rel="prefetch" href="/js-book/assets/js/97.35a26a0d.js"><link rel="prefetch" href="/js-book/assets/js/98.d4246364.js"><link rel="prefetch" href="/js-book/assets/js/99.90d9fa94.js">
    <link rel="stylesheet" href="/js-book/assets/css/0.styles.8a3be0d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/js-book/" class="home-link router-link-active"><!----> <span class="site-name">云上舟</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/js-book/home/home.html" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他博客" class="dropdown-title"><span class="title">其他博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他博客" class="mobile-dropdown-title"><span class="title">其他博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/YunShangZhou" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/js-book/home/home.html" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他博客" class="dropdown-title"><span class="title">其他博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他博客" class="mobile-dropdown-title"><span class="title">其他博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/YunShangZhou" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/js-book/home/home.html" class="sidebar-link">序言</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/js-book/book/BEM规范" class="sidebar-heading clickable open"><span>博客</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/js-book/book/BEM规范.html" class="sidebar-link">BEM规范</a></li><li><a href="/js-book/book/BFC详解.html" class="sidebar-link">BFC详解</a></li><li><a href="/js-book/book/CI&amp;CD之自动部署.html" class="sidebar-link">CI&amp;CD之自动部署</a></li><li><a href="/js-book/book/JS原型与原型链.html" class="sidebar-link">JS原型与原型链</a></li><li><a href="/js-book/book/JS继承.html" class="sidebar-link">JS继承</a></li><li><a href="/js-book/book/Memorize.html" class="sidebar-link">Memorize</a></li><li><a href="/js-book/book/Pinia用法.html" class="sidebar-link">Pinia用法</a></li><li><a href="/js-book/book/new操作符.html" class="sidebar-link">new操作符</a></li><li><a href="/js-book/book/typeof及instanceof原理.html" class="sidebar-link">typeof及instanceof原理</a></li><li><a href="/js-book/book/事件循环.html" class="sidebar-link">事件循环</a></li><li><a href="/js-book/book/前端中的跨域.html" class="sidebar-link">前端中的跨域</a></li><li><a href="/js-book/book/前端如何处理10万条数据.html" class="sidebar-link">前端如何处理10万条数据</a></li><li><a href="/js-book/book/前端鉴权.html" class="active sidebar-link">前端鉴权</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js-book/book/前端鉴权.html#存储方案" class="sidebar-link">存储方案</a></li><li class="sidebar-sub-header"><a href="/js-book/book/前端鉴权.html#cookie存储" class="sidebar-link">Cookie存储</a></li><li class="sidebar-sub-header"><a href="/js-book/book/前端鉴权.html#服务端session" class="sidebar-link">服务端session</a></li><li class="sidebar-sub-header"><a href="/js-book/book/前端鉴权.html#应用方案-token" class="sidebar-link">应用方案: token</a></li><li class="sidebar-sub-header"><a href="/js-book/book/前端鉴权.html#应用方案-jwt" class="sidebar-link">应用方案 JWT</a></li><li class="sidebar-sub-header"><a href="/js-book/book/前端鉴权.html#session和token" class="sidebar-link">session和token</a></li><li class="sidebar-sub-header"><a href="/js-book/book/前端鉴权.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/js-book/book/各作用域的理解.html" class="sidebar-link">各作用域的理解</a></li><li><a href="/js-book/book/回车url后，页面的变化过程.html" class="sidebar-link">回车url后，页面的变化过程</a></li><li><a href="/js-book/book/实现bind、apply、call.html" class="sidebar-link">实现bind、apply、call</a></li><li><a href="/js-book/book/彻底了解this.html" class="sidebar-link">彻底了解this</a></li><li><a href="/js-book/book/提高代码健壮性.html" class="sidebar-link">提高代码健壮性</a></li><li><a href="/js-book/book/柯里化.html" class="sidebar-link">柯里化</a></li><li><a href="/js-book/book/正则表达式的基础使用.html" class="sidebar-link">正则表达式的基础使用</a></li><li><a href="/js-book/book/闭包.html" class="sidebar-link">闭包</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js-book/note/ES6之变量声明" class="sidebar-heading clickable"><span>想法/笔记</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js-book/components/树形控件的简单实现" class="sidebar-heading clickable"><span>组件实现</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js-book/dailyapi/手写一个ajax" class="sidebar-heading clickable"><span>手写API</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js-book/basic/前言" class="sidebar-heading clickable"><span>基础巩固</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js-book/not-tecnology/第一年总结" class="sidebar-heading clickable"><span>非技术部分</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h1> <p></p><div class="table-of-contents"><ul><li><a href="#存储方案">存储方案</a></li><li><a href="#cookie存储">Cookie存储</a><ul><li><a href="#配置-domain-path">配置: Domain/Path</a></li><li><a href="#配置-exipres-max-age">配置: Exipres/ Max-Age</a></li><li><a href="#配置-secure-httponly">配置： Secure / HttpOnly</a></li><li><a href="#http-头对-cookie-的读写">HTTP 头对 cookie 的读写</a></li><li><a href="#前端对-cookie的读写">前端对 cookie的读写</a></li></ul></li><li><a href="#服务端session">服务端session</a><ul><li><a href="#示例图">示例图</a></li><li><a href="#session的存储方式">Session的存储方式</a></li><li><a href="#session-的过期和销毁">Session 的过期和销毁</a></li><li><a href="#session-的分布式问题">Session 的分布式问题</a></li><li><a href="#node-js下的session处理">node.js下的session处理</a></li><li><a href="#问题的萌生">问题的萌生</a></li><li><a href="#问题的解决">问题的解决</a></li></ul></li><li><a href="#应用方案-token">应用方案: token</a><ul><li><a href="#token流程图">token流程图</a></li><li><a href="#token流程">token流程</a></li><li><a href="#客户端token的存储方式">客户端token的存储方式</a></li><li><a href="#token的编码">token的编码</a></li><li><a href="#防篡改">防篡改</a></li><li><a href="#示例图">示例图</a></li></ul></li><li><a href="#应用方案-jwt">应用方案 JWT</a><ul><li><a href="#示例图">示例图</a></li><li><a href="#refresh-token">refresh token</a></li><li><a href="#示例图">示例图</a></li></ul></li><li><a href="#session和token">session和token</a></li><li><a href="#总结">总结</a></li></ul></div><p></p> <h1 id="前端鉴权由来"><a href="#前端鉴权由来" class="header-anchor">#</a> 前端鉴权由来</h1> <p>HTTP是无状态的，在HTTP请求方和响应方之前并不能做 <strong>状态维护</strong> ，在 <strong>三次握手</strong> <strong>四次挥手</strong> 之后，他们的状态都无法直接获取。比如 各类网站，都要求用户 <strong>登陆注册</strong> ，这个时候HTTP该如何知道用户的 <strong>登录/等出状态</strong> 呢？ 下文将例举利用 <strong>不同存储</strong>  作为一种 <strong>标记</strong> 来保存状态 ，实现 <strong>前端鉴权</strong>。</p> <h2 id="存储方案"><a href="#存储方案" class="header-anchor">#</a> 存储方案</h2> <ul><li>挂载在全局变量上，但缺点是： 一刷新页面，数据就没了</li> <li>挂载在 cookie、sessionStorage、localStorage等，不用担心刷新丢失的问题，开发者可以自由选择其中一种方式。</li></ul> <p>只要有地方存储，请求的时候 <strong>携参</strong> 给接口即可。</p> <h2 id="cookie存储"><a href="#cookie存储" class="header-anchor">#</a> Cookie存储</h2> <p>cookie 也是前端存储的一种，相比于 localStorage 等其他方式，借助 HTTP 头、浏览器能力，cookie 可以做到前端无感知。</p> <p>一般过程是这样的：</p> <ul><li>在提供标记的接口，通过 HTTP 返回头的 Set-Cookie 字段，直接<strong>种</strong>到浏览器上</li> <li>浏览器发起请求时，会自动把 cookie 通过 HTTP 请求头的 Cookie 字段，带给接口</li></ul> <h3 id="配置-domain-path"><a href="#配置-domain-path" class="header-anchor">#</a> 配置: Domain/Path</h3> <p>可以通过 <code>Domian</code>/<code>Path</code>两级 去限制 <strong>空间范围</strong></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Domain属性指定浏览器发出 HTTP 请求时，哪些域名要附带这个 Cookie。如果没有指定该属性，浏览器会默认将其设为当前 URL 的一级域名，比如 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.example.com" target="_blank" rel="noopener noreferrer">www.example.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 会设为 example.com，而且以后如果访问example.com的任何子域名，HTTP 请求也会带上这个 Cookie。如果服务器在Set-Cookie字段指定的域名，不属于当前域名，浏览器会拒绝这个 Cookie。</p> <p>Path属性指定浏览器发出 HTTP 请求时，哪些路径要附带这个 Cookie。只要浏览器发现，Path属性是 HTTP 请求路径的开头一部分，就会在头信息里面带上这个 Cookie。比如，PATH属性是/，那么请求/docs路径也会包含该 Cookie。当然，前提是域名必须一致。</p> <p><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavascript.ruanyifeng.com%2Fbom%2Fcookie.html" target="_blank" rel="noopener noreferrer">Cookie — JavaScript 标准参考教程（alpha）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="配置-exipres-max-age"><a href="#配置-exipres-max-age" class="header-anchor">#</a> 配置: Exipres/ Max-Age</h3> <p>可以通过 <code>Expires</code>和<code>Max-Age</code> 中的一种，来限制<code>cookie</code>的 <strong>时间范围</strong></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Expires属性指定一个具体的到期时间，到了指定时间以后，浏览器就不再保留这个 Cookie。它的值是 UTC 格式。如果不设置该属性，或者设为null，Cookie 只在当前会话（session）有效，浏览器窗口一旦关闭，当前 Session 结束，该 Cookie 就会被删除。另外，浏览器根据本地时间，决定 Cookie 是否过期，由于本地时间是不精确的，所以没有办法保证 Cookie 一定会在服务器指定的时间过期。</p> <p>Max-Age属性指定从现在开始 Cookie 存在的秒数，比如60 * 60 * 24 * 365（即一年）。过了这个时间以后，浏览器就不再保留这个 Cookie。</p> <p>如果同时指定了Expires和Max-Age，那么Max-Age的值将优先生效。</p> <p>如果Set-Cookie字段没有指定Expires或Max-Age属性，那么这个 Cookie 就是 Session Cookie，即它只在本次对话存在，一旦用户关闭浏览器，浏览器就不会再保留这个 Cookie。</p> <p><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavascript.ruanyifeng.com%2Fbom%2Fcookie.html" target="_blank" rel="noopener noreferrer">Cookie — JavaScript 标准参考教程（alpha）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="配置-secure-httponly"><a href="#配置-secure-httponly" class="header-anchor">#</a> 配置： Secure / HttpOnly</h3> <p>用于配置<code>cookie</code>的使用方式。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Secure属性指定浏览器只有在加密协议 HTTPS 下，才能将这个 Cookie 发送到服务器。另一方面，如果当前协议是 HTTP，浏览器会自动忽略服务器发来的Secure属性。该属性只是一个开关，不需要指定值。如果通信是 HTTPS 协议，该开关自动打开。</p> <p>HttpOnly属性指定该 Cookie 无法通过 JavaScript 脚本拿到，主要是Document.cookie属性、XMLHttpRequest对象和 Request API 都拿不到该属性。这样就防止了该 Cookie 被脚本读到，只有浏览器发出 HTTP 请求时，才会带上该 Cookie。
—— Cookie — JavaScript 标准参考教程（alpha）</p></div> <h3 id="http-头对-cookie-的读写"><a href="#http-头对-cookie-的读写" class="header-anchor">#</a> HTTP 头对 cookie 的读写</h3> <p>HTTP 返回的一个<code>Set-Cookie</code>头用于向浏览器写入 <strong>一条</strong> cookie,格式为 cookie 键值+配置键值。例如:</p> <p><code>Set-Cookie: username=jimu; domain=jimu.com; path=/blog; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly</code></p> <br> <p>若想多次<code>set-cookie</code>,则多给几个即可（一次HTTP请求允许重复)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> username<span class="token operator">=</span>jimu<span class="token punctuation">;</span> domain<span class="token operator">=</span>jimu<span class="token punctuation">.</span>com
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> height<span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">;</span> domain<span class="token operator">=</span>me<span class="token punctuation">.</span>jimu<span class="token punctuation">.</span>com
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> weight<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">;</span> domain<span class="token operator">=</span>me<span class="token punctuation">.</span>jimu<span class="token punctuation">.</span>com
</code></pre></div><p>HTTP请求的<code>Cookie</code>头用于浏览器把符合当前 空间、时间、使用方式 配置的所有cookie一并发给服务端。因为由浏览器做了<strong>筛选判断</strong>，就不需要归还配置内容了，只要<strong>发送键值</strong>就可以。</p> <p><code>Cookie: username=jimu; height=180; weight=80</code></p> <h3 id="前端对-cookie的读写"><a href="#前端对-cookie的读写" class="header-anchor">#</a> 前端对 cookie的读写</h3> <p>前端可以自己创建 <code>cookie</code>, 如果服务端创建的<code>cookie</code> 没有加上<code>HttpOnly</code>， 那么前端也可以<strong>也可以修改</strong>他给的 <code>cookie</code>。</p> <p>调用<code>document.cookie</code>可以创建、修改<code>cookie</code>。和 <code>HTTP</code> 一样，能读到所有的 非<code>HttpOnly</code> 的 <code>cookie</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// username=jimu; height=180; weight=80</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在了解了 <code>cookie</code>后，便知道<code>cookie</code>是最便捷的维持HTTP请求状态的方式，大多数前端鉴权问题都是靠cookie解决的。当然也可以选用别的存储方式...</p></div> <h1 id="应用方案"><a href="#应用方案" class="header-anchor">#</a> 应用方案</h1> <h2 id="服务端session"><a href="#服务端session" class="header-anchor">#</a> 服务端session</h2> <h3 id="示例图"><a href="#示例图" class="header-anchor">#</a> 示例图</h3> <img src="/js-book/token/session_liuchengtu.png"> <ul><li><p>浏览器登录发送账号密码，服务端查用户库，校验用户</p></li> <li><p>服务端把用户登录状态存为 <code>Session</code>，生成一个 <code>sessionId</code></p></li> <li><p>通过登录接口返回，把 <code>sessionId</code> <code>set</code> 到 <code>cookie</code> 上</p></li> <li><p>此后浏览器再请求业务接口，<code>sessionId</code> 随 <code>cookie</code> 带上</p></li> <li><p>服务端查 <code>sessionId</code> 校验 <code>session</code></p></li> <li><p>成功后正常做业务处理，返回结果</p></li></ul> <h3 id="session的存储方式"><a href="#session的存储方式" class="header-anchor">#</a> Session的存储方式</h3> <p>显然，服务端只是给<code>cookie</code>一个<code>sessionId</code>,而 <code>session</code>的具体内容(可能包含用户信息、session 状态等)。存储的方式有几种:</p> <ul><li>Redis（推荐）：内存型数据库，<a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.redis.cn%2F" target="_blank" rel="noopener noreferrer">redis中文官方网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。以 key-value 的形式存，正合 sessionId-sessionData 的场景；且访问快。</li> <li>内存：直接放到变量里。一旦服务重启就没了</li> <li>数据库：普通数据库。性能不高。</li></ul> <h3 id="session-的过期和销毁"><a href="#session-的过期和销毁" class="header-anchor">#</a> <strong>Session 的过期和销毁</strong></h3> <p>只要把存储的 session 数据销毁就可以。</p> <h3 id="session-的分布式问题"><a href="#session-的分布式问题" class="header-anchor">#</a> <strong>Session 的分布式问题</strong></h3> <p>通常服务端是集群，而用户请求过来会走一次负载均衡，不一定打到哪台机器上。那一旦用户后续接口请求到的机器和他登录请求的机器不一致，或者登录请求的机器宕机了，session 不就失效了吗？</p> <p>这个问题现在有几种解决方式。</p> <ul><li>一是从存储角度，把 session 集中存储。如果我们用独立的 Redis 或普通数据库，就可以把 session 都存到一个库里。</li> <li>二是从分布角度，让相同 IP 的请求在负载均衡时都打到同一台机器上。以 nginx 为例，可以配置 <code>ip_hash</code> 来实现。</li></ul> <p>但通常还是采用第一种方式，因为第二种相当于阉割了负载均衡，且仍没有解决用户请求的机器宕机的问题。</p> <h3 id="node-js下的session处理"><a href="#node-js下的session处理" class="header-anchor">#</a> node.js下的session处理</h3> <p>前面的图很清楚了，服务端要实现对<code>cookie</code>和<code>session</code>的存取，实现起来要做的事还是很多的。在<code>npm</code>中，已经有封装好的中间件，比如<code>express-session-npm</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fexpress-session" target="_blank" rel="noopener noreferrer">express-session  -  npm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 主要实现了：</p> <ul><li>封装了对<code>cookie</code>的读写操作，并提供配置项配置字段、加密方式、过期时间等。</li> <li>封装了对<code>session</code>的存取操作，并提供配置项配置<code>session</code>存储方式（内存/redis）、存储规则等。</li> <li>给req提供了<code>session</code>属性，控制属性的<code>set/get</code>并响应到<code>cookie</code>和<code>session</code>存取上，并给<code>req.session</code>提供了一些方法.</li></ul></div> <h3 id="问题的萌生"><a href="#问题的萌生" class="header-anchor">#</a> 问题的萌生</h3> <p>session的维护给服务端造成很大困扰，我们必须找地方存放它，又要考虑分布式的问题，这似乎有些麻烦。</p> <br> <p>一个登录场景，要做的事情仅仅是:</p> <ol><li>登录，post 账号密码</li> <li>校验成功，返回一个标记</li> <li>请求接口携带标记</li> <li>标记的校验</li> <li>校验成功/失败，结果处理。</li></ol> <h3 id="问题的解决"><a href="#问题的解决" class="header-anchor">#</a> 问题的解决</h3> <p>使用<code>token</code>来做前端鉴权</p> <h2 id="应用方案-token"><a href="#应用方案-token" class="header-anchor">#</a> 应用方案: token</h2> <p>一个登录场景，也不必往 session 存太多东西，那为什么不直接打包到 cookie 中呢？这样服务端不用存了，每次只要核验 cookie 带的证件有效性就可以了，也可以携带一些轻量的信息。这种方式通常被叫做 token。</p> <h3 id="token流程图"><a href="#token流程图" class="header-anchor">#</a> token流程图</h3> <img src="/js-book/token/token_liuchengtu.png"> <h3 id="token流程"><a href="#token流程" class="header-anchor">#</a> token流程</h3> <p>token 的流程是这样的：</p> <ul><li>用户登录，服务端校验账号密码，获得用户信息</li> <li>把 <strong>用户信息、token</strong> 配置编码成 <code>token</code>，通过 <code>cookie</code> <code>set</code> 到浏览器</li> <li>此后用户请求业务接口，通过 cookie 携带 token</li> <li>接口校验 token 有效性，进行正常业务接口处理</li></ul> <h3 id="客户端token的存储方式"><a href="#客户端token的存储方式" class="header-anchor">#</a> 客户端token的存储方式</h3> <p>cookie并不是客户端存储凭证的唯一方式。token 因为它的无状态性，有效期、使用限制都包在 token 内容里，对 cookie 的管理能力依赖较小，客户端存起来就显得更自由。但 web 应用的主流方式仍是放在 cookie 里。</p> <h3 id="token的编码"><a href="#token的编码" class="header-anchor">#</a> token的编码</h3> <p>通常都是采用<code>base64</code>，比如 <code>eyJ1c2VyaWQiOiJhIn0=</code>就是 <code>{&quot;userid&quot;:&quot;abb”}</code>的转码结果。</p> <h3 id="防篡改"><a href="#防篡改" class="header-anchor">#</a> 防篡改</h3> <p>如果用户 cdd 拿<code>{&quot;userid&quot;:&quot;abb”}</code>转了个 base64，再手动修改了自己的 token 为 <code>eyJ1c2VyaWQiOiJhIn0=</code>，便能能直接发送请求访问到 abb 的数据。</p> <h4 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h4> <p>给token加密作为 <strong>签名</strong> ，用来识别token是否被篡改过。例如在 <code>cookie-session-npm</code>库中，增加了两项配置:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'iAmSecret'</span><span class="token punctuation">,</span>
<span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</code></pre></div><p>这样会多种一个 .sig cookie, 里面的值就是 <code>{&quot;userid&quot;:&quot;abb”}</code> 和 <code>iAmSecret</code>通过加密算法计算出来的。常见加密的链接: (<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Fapi%2Fsystem.security.cryptography.hmacsha256%3Fredirectedfrom%3DMSDN%26view%3Dnetframework-4.8" target="_blank" rel="noopener noreferrer">HMACSHA256 类 (System.Security.Cryptography) | Microsoft Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="示例图-2"><a href="#示例图-2" class="header-anchor">#</a> 示例图</h3> <img src="/js-book/token/token_secret.png"> <br> <p>现在cdd虽然造得出 <code>abb</code>的token，但他无法造出加密后的签名，因此解决了 <strong>篡改</strong> 盗用他人<code>token</code>的问题。</p> <h2 id="应用方案-jwt"><a href="#应用方案-jwt" class="header-anchor">#</a> 应用方案 JWT</h2> <p>上述token做法额外增加了 cookie 数量，数据本身也没有规范的格式，所以 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fjwt.io%2Fintroduction%2F" target="_blank" rel="noopener noreferrer">JSON Web Token Introduction - jwt.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 横空出世了。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>JSON Web Token (JWT) 是一个开放标准，定义了一种传递 JSON 信息的方式。这些信息通过数字签名确保可信。</p></div> <p>它是一种成熟的 token 字符串生成方案，包含了我们前面提到的数据、签名。代码示例：</p> <p><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyaWQiOiJhIiwiaWF0IjoxNTUxOTUxOTk4fQ.2jf3kl_uKWRkwjOP6uQRJFqMlwSABcgqqcJofFH5XCo</code></p> <h3 id="示例图-3"><a href="#示例图-3" class="header-anchor">#</a> 示例图</h3> <img src="/js-book/token/jwt_liuchengtu.png"> <p>类型、加密算法的选项，以及 JWT 标准数据字段，可以参考 <a href="https://link.juejin.cn/?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc7519%23section-4.1" target="_blank" rel="noopener noreferrer">RFC 7519 - JSON Web Token (JWT)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>node 上同样有相关的库实现：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fexpress-jwt" target="_blank" rel="noopener noreferrer">express-jwt - npm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fkoa-jwt" target="_blank" rel="noopener noreferrer">koa-jwt - npm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="refresh-token"><a href="#refresh-token" class="header-anchor">#</a> refresh token</h3> <p>业务接口用来鉴权的 token，我们称之为 access token。越是权限敏感的业务，我们越希望 access token 有效期足够短，以避免被盗用。但过短的有效期会造成 access token 经常过期，过期后怎么办呢？</p> <p>一种办法是，让用户重新登录获取新 token，显然不够友好，要知道有的 access token 过期时间可能只有几分钟。</p> <p>另外一种办法是，再来一个 token，一个专门生成 access token 的 token，我们称为 refresh token。</p> <ul><li>access token 用来访问业务接口，由于有效期足够短，盗用风险小，也可以使请求方式更宽松灵活</li> <li>refresh token 用来获取 access token，有效期可以长一些，通过独立服务和严格的请求方式增加安全性；由于不常验证，也可以如前面的 session 一样处理</li></ul> <p>有了 refresh token 后，几种情况的请求流程变成这样：</p> <h3 id="示例图-4"><a href="#示例图-4" class="header-anchor">#</a> 示例图</h3> <img src="/js-book/token/refresh_token_liuchengtu.png"> <h2 id="session和token"><a href="#session和token" class="header-anchor">#</a> session和token</h2> <p>session 和 token 都是边界很模糊的概念，就像前面说的，refresh token 也可能以 session 的形式组织维护。</p> <p>狭义上，我们通常认为 session 是<strong>种在 cookie 上、数据存在服务端</strong>的认证方案，token 是<strong>客户端存哪都行、数据存在 token 里</strong>的认证方案。对 session 和 token 的对比本质上是<strong>客户端存 cookie / 存别地儿</strong>、<strong>服务端存数据 / 不存数据</strong>的对比。</p> <p><strong>客户端存 cookie / 存别地儿</strong></p> <p>存 cookie 固然方便不操心，但问题也很明显：</p> <ul><li>在浏览器端，可以用 cookie（实际上 token 就常用 cookie），但出了浏览器端，没有 cookie 怎么办？</li> <li>cookie 是浏览器在域下自动携带的，这就容易引发 CSRF 攻击（<a href="https://link.juejin.cn?target=https%3A%2F%2Ftech.meituan.com%2F2018%2F10%2F11%2Ffe-security-csrf.html" target="_blank" rel="noopener noreferrer">前端安全系列（二）：如何防止CSRF攻击？ - 美团技术团队<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</li></ul> <p>存别的地方(例如http头部<code>Authorization: Bearer &lt;token&gt;</code>等)，可以解决没有 cookie 的场景；通过参数等方式手动带，可以避免 <code>CSRF</code> 攻击。</p> <p><strong>服务端存数据 / 不存数据</strong></p> <ul><li>存数据：请求只需携带 id，可以大幅缩短认证字符串长度，减小请求体积</li> <li>不存数据：1. 不需要服务端整套的解决方案和分布式处理，降低硬件成本 2. 避免查库带来的<strong>验证延迟</strong></li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li>HTTP 是无状态的，为了维持前后请求，需要前端存储标记</li> <li>cookie 是一种完善的标记方式，通过 HTTP 头或 js 操作，有对应的安全策略，是大多数状态管理方案的基石</li> <li>session 是一种状态管理方案，前端通过 cookie 存储 id，后端存储数据，但后端要处理分布式问题</li> <li>token 是另一种状态管理方案，相比于 session 不需要后端存储，数据全部存在前端，解放后端，释放灵活性</li> <li>token 的编码技术，通常基于 base64，或增加加密算法防篡改，jwt 是一种成熟的编码方案</li> <li>在复杂系统中，token 可通过 service token、refresh token 的分权，同时满足安全性和用户体验</li> <li>session 和 token 的对比就是用不用cookie和后端存不存的对比</li></ul> <h1 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h1> <ol><li><a href="https://juejin.cn/post/6898630134530752520#comment" target="_blank" rel="noopener noreferrer">前端鉴权的兄弟们：cookie、session、token、jwt、单点登录 - 掘金 (juejin.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6977280069437751310" target="_blank" rel="noopener noreferrer">JWT 前端应该把它存在哪儿？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html" target="_blank" rel="noopener noreferrer">Json Web Token 阮一峰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js-book/book/前端如何处理10万条数据.html" class="prev">
        前端如何处理10万条数据
      </a></span> <span class="next"><a href="/js-book/book/各作用域的理解.html">
        各作用域的理解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/js-book/assets/js/app.f61b122d.js" defer></script><script src="/js-book/assets/js/2.2de41c35.js" defer></script><script src="/js-book/assets/js/3.693556bf.js" defer></script><script src="/js-book/assets/js/31.8158df5d.js" defer></script>
  </body>
</html>
